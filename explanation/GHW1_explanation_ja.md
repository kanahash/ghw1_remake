# GHW1: 2Dデルタfジャイロフルイド長谷川-若谷コード

このドキュメントは、**2Dデルタfジャイロフルイド（修正版）長谷川-若谷コード (GHW1)** に関する詳細な説明です。このコードは、周期境界条件を持つ磁化プラズマにおける2次元のドリフト波乱流と渦のダイナミクスをシミュレーションするために設計されています。

---

## 概要と目的

GHW1は、**磁化プラズマ中の2Dドリフト波乱流と渦ダイナミクス**をシミュレーションします。特に、冷たいイオン（$\tau_i=0$）の極限では、Numata氏の論文（arXiv:0708.4317）の結果と比較可能です。

---

## バージョン情報と変更点

* **バージョン:** V1.25 (2025年1月10日)
* **V1.24からの主な変更点:**
    * **FFTの高速化:** 複素FFTの代わりに、実数から複素数への変換 (r2c) と複素数から実数への変換 (c2r) を使用することで、FFTの処理速度が向上しました。
    * **初期条件の関数化:** 初期条件の設定部分を関数に分離し、コードの可読性と明瞭性を高めました。

---

## 理論的背景と参考文献

* **使用例:** バージョン1.0の使用例は、arXiv:1708.06213で確認できます。
* **正規化と数値計算手法:** 類似のfull-fバージョンにおける正規化と数値計算手法については、arXiv:1502.05494を参照してください。
* **ジャイロフルイド理論:** ジャイロフルイド理論とモデルに関する詳細な背景は、上記の参考文献でさらに詳しく学ぶことができます。

---

## 実行環境と依存関係

このコードを実行するには、いくつかのライブラリが必要です。

* **必須ライブラリ:** `fftw3` (FFTライブラリ) および `omp` (OpenMP) が必要です。これらは、ほとんどのLinuxディストリビューションで利用可能です。
* **Linuxでの実行準備:**
    * スタックサイズの制限を解除: `ulimit -s unlimited`
    * OpenMPのスタックサイズを設定: `export OMP_STACKSIZE=8G`
* **コンパイル:** 付属の`makefile`を使用します。プロジェクトのディレクトリで `make ghw1` を実行してください。
* **実行:** `time ./ghw1` コマンドでコードを実行できます。`time` コマンドを使用することで、実行時間を計測できます。
* **並列化:** OpenMPによる並列化に対応しています。最大8コア程度までは、良好な高速化が期待できます。
* **実行時間:** シミュレーションのグリッドサイズに依存します。例えば、$64 \times 64$ のグリッドでは数分、$1024 \times 1024$ のグリッドでは数時間かかる場合があります。

---

## パフォーマンスと数値的安定性に関する注意点

* **インライン化:** コードのほとんどのサブルーチンは、関数呼び出しではなくインライン化されています。これはコーディングの美しさよりも、**コードの実行速度を大幅に向上させるため**です。
* **時間ステップとハイパー粘性:** 数値的な不安定性によるクラッシュを防ぐため、**時間ステップ (`dt`) とハイパー粘性 (`diff`) は、グリッド解像度に応じて調整する必要があります。** これらの値は、試行錯誤によって最適値を決定してください。
* **`chat`と`delta`:** これらのパラメータの選択も、時間ステップとシミュレーションの典型的な時間スケールに影響を与えます。

---

## その他

* **RAMディスクでの実行:** 出力時間の短縮のため、RAMディスク（例: `/ramdisc/`）にファイルを置いて実行することが推奨されます。
    * `mkdir /ramdisc`
    * `sudo mount -t tmpfs none /ramdisc -o size=2048m`
* **結果の可視化:**
    * **1Dグラフ:** `xmgrace`などのプロットプログラムを使用して可視化できます。
    * **2D等高線プロット:** 付属の`gnuplot`スクリプトファイル (`gpl-ctr.plt`) を使用します。
    * **ライブシミュレーション:** `gpl-ctr.plt`ファイル内の`reread`行のコメントを解除し、`gnuplot`で `load 'gpl-ctr.plt'` を実行すると、シミュレーションの進行状況をリアルタイムで確認できます。

---

## Makefileの例

以下は、コンパイル時に使用される`Makefile`の例です。

```makefile
exec = ghw1
objs = ghw1.o
LFLAGS = -mcmodel=large -march=native -lm -O2 -fopenmp -lfftw3_omp -lfftw3
CFLAGS = -I.
LIBS = /usr/lib64

all: $(exec)

$(exec): $(objs)
	g++  $(exec).C -o $@  $(LFLAGS) -L$(LIBS)
	rm *.o

ghw.o: ghw1.C
	g++  -c $< -o $@
	